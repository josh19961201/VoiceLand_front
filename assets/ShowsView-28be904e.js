import{Q as O,P,ad as U,Z as y,_ as $,a2 as A,E as J,W as Q,K as W,D as Z,U as G}from"./router-6446057b.js";import{b6 as X,J as b,a8 as x,ad as ee,a_ as te,ag as a,af as o,ah as D,a7 as ae,b8 as f,a$ as ne,bb as le,r as Y}from"./plugin-vueexport-helper-1542df20.js";import{_ as se,a as oe}from"./DynamicInput-8d7a9b6d.js";import{c as ie}from"./headers-d0c66c5d.js";import{_ as pe}from"./light-0e509a21.js";import{_ as re}from"./DataTable-e09467ad.js";import{N as C}from"./Button-a81ecdea.js";import{_ as ue}from"./FormItemGridItem-7c66574f.js";import{_ as de}from"./Switch-f2d62cfd.js";import{_ as _e}from"./Upload-0a70cbc5.js";import"./vue-router-154c86bc.js";import"./Icon-8a75e956.js";import"./light-f81583d7.js";import"./Remove-0a232454.js";import"./Warning-3f6bd821.js";import"./light-d50e1129.js";import"./light-fab128ef.js";import"./Image-d1a6d314.js";import"./light-9f5e61aa.js";const me={__name:"ShowsView",setup(ce){const F=O(),_=P(),w=b(!1),m=b([]),M={image:{required:!0,message:"請上傳圖片"},title:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},date:{},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},artists:{required:!0,message:"請選擇演出者"}},N=[{label:"Sabrina Band",value:"Sabrina Band"},{label:"Coastal Kanpai",value:"Coastal Kanpai"},{label:"Yellow Flower",value:"Yellow Flower"},{label:"Faye Hong",value:"Faye Hong"}],V=[{label:"Facebook",value:"fb"},{label:"Information",value:"info"},{label:"Ticket",value:"ticket"}],j=()=>({linkType:"",link:""}),h=b(null),p=x([]),e=x({_id:"",image:[],title:"",date:U().format("YYYY.MM.DD"),description:"",display:!1,artists:[],links:[],dialog:!1,idx:-1}),T=n=>{n===-1?(e._id="",e.image=[],e.title="",e.date=U().format("YYYY.MM.DD"),e.description="",e.display=!1,e.artists=[],e.links=[],e.dialog=!1,e.idx=-1):(e._id=p[n]._id,e.title=p[n].title,e.date=p[n].date,e.description=p[n].description,e.display=p[n].display,e.artists=p[n].artists,e.links=p[n].links,e.dialog=p[n].dialog,e.idx=n,m.value.push({id:"001",name:"image",status:"finished",url:p[n].image}),e.image=m.value),e.dialog=!0},B=n=>{var t,i;e.image=(i=(t=n.fileList)==null?void 0:t[0])==null?void 0:i.file},g=()=>{m.value=[],e.dialog=!1},S=async()=>{var n;return(n=h.value)==null||n.validate(async t=>{var i,d,u;if(t)F.error("請檢查資料是否完整");else{const r=new FormData;(i=e.image[0])!=null&&i.url&&(e.image=e.image[0].url),r.append("image",e.image),r.append("title",e.title),r.append("date",e.date),r.append("description",e.description),r.append("display",e.display);for(const s of e.artists)r.append("artists",s);e.links=e.links.map(s=>{const v=s.linkType,c=s.link;return{linkType:v,link:c}});for(const s of e.links)r.append("linksType",Object.entries(s)[0][1]),r.append("linksValue",Object.entries(s)[1][1]);try{if(e._id.length===0){const{data:s}=await y.post("/shows",r);p.push(s.result),_.success({title:"新增成功",content:"演出活動新增成功",positiveText:"確認"}),g()}else{const{data:s}=await y.patch("/shows/"+e._id,r);p[e.idx]=s.result,_.success({title:"編輯成功",content:"演出資訊編輯成功",positiveText:"確認"}),g()}e.dialog=!1}catch(s){_.error({title:"新增失敗",content:((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||"發生錯誤",positiveText:"確認"}),console.log(s)}w.value=!1}}),!1};(async()=>{var n,t;try{const{data:i}=await y.get("/shows/all");p.push(...i.result)}catch(i){_.error({title:"載入失敗",content:((t=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const q=(({edit:n})=>[{title:"演出名稱",key:"title"},{title:"日期",key:"date"},{title:"演出者",key:"artists",render(t,i){return Y(G,{},{default:()=>t.artists.join("、")})}},{title:"",key:"edit",render(t,i){return Y(C,{strong:!0,tertiary:!0,size:"small",onClick:()=>n(t,i)},{default:()=>"編輯"})}}])({edit(n,t){T(t)}});return(n,t)=>{const i=ie,d=$,u=ue,r=de,s=se,v=_e,c=A,R=oe,H=J,I=Q,K=W,z=pe,E=Z,L=re;return ee(),te(ae,null,[a(i,{class:"pageTitle"},{default:o(()=>[f(" 演出管理 ")]),_:1}),a(D(C),{onClick:t[0]||(t[0]=l=>T(-1))},{default:o(()=>[f(" 新增演出 ")]),_:1}),a(z,{show:e.dialog,"onUpdate:show":t[8]||(t[8]=l=>e.dialog=l),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":g,"on-positive-click":S,closable:!1,loading:w.value},{header:o(()=>[ne("div",null,le(e._id.length>0?"編輯演出":"新增演出"),1)]),default:o(()=>[a(K,null,{default:o(()=>[a(I,{ref_key:"fromRef",ref:h,rules:M,model:e},{default:o(()=>[a(H,{cols:12,"x-gap":12},{default:o(()=>[a(u,{span:10,label:"演出名稱",path:"title"},{default:o(()=>[a(d,{value:e.title,"onUpdate:value":t[1]||(t[1]=l=>e.title=l),placeholder:"請輸入活動名稱"},null,8,["value"])]),_:1}),a(u,{span:2,label:"公開",path:"display"},{default:o(()=>[a(r,{value:e.display,"onUpdate:value":t[2]||(t[2]=l=>e.display=l)},null,8,["value"])]),_:1}),a(u,{span:6,label:"演出日期",path:"date"},{default:o(()=>[a(s,{"formatted-value":e.date,"onUpdate:formatted-value":t[3]||(t[3]=l=>e.date=l),"value-format":"yyyy.MM.dd",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),a(u,{span:6,label:"圖片",path:"image"},{default:o(()=>[a(v,{value:e.image,"onUpdate:value":t[4]||(t[4]=l=>e.image=l),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,max:1,onChange:B},{default:o(()=>[f(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1}),a(u,{span:12,label:"演出者",path:"artists"},{default:o(()=>[a(c,{value:e.artists,"onUpdate:value":t[5]||(t[5]=l=>e.artists=l),options:N,multiple:"","show-checkmark":!1},null,8,["value"])]),_:1}),a(u,{span:12,label:"演出資訊",path:"description"},{default:o(()=>[a(d,{value:e.description,"onUpdate:value":t[6]||(t[6]=l=>e.description=l),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這場演出有多酷！"},null,8,["value"])]),_:1}),a(u,{span:12,label:"外部連結",path:"links"},{default:o(()=>[a(R,{value:e.links,"onUpdate:value":t[7]||(t[7]=l=>e.links=l),"on-create":j},{"create-button-default":o(()=>[f(" 加入外部連結 ")]),default:o(({value:l})=>[a(c,{value:l.linkType,"onUpdate:value":k=>l.linkType=k,options:V},null,8,["value","onUpdate:value"]),a(d,{value:l.link,"onUpdate:value":k=>l.link=k,type:"text",placeholder:"請輸入連結"},null,8,["value","onUpdate:value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),a(E),a(L,{columns:D(q),data:p},null,8,["columns","data"])],64)}}},Se=X(me,[["__scopeId","data-v-e9b0bcf3"]]);export{Se as default};
