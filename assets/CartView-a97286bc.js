import{B as v,D as q,S as b,L as x}from"./router-2a9f4963.js";import{_ as u}from"./vue-router-09c1997e.js";import{aL as V,l as p,G as m,K as B,aD as D,aE as T,N as n,M as i,O as c,h as o,aN as d,aQ as z}from"./plugin-vueexport-helper-7bd45fc8.js";import{_ as F}from"./DataTable-09dc83c0.js";import{c as L,N as S}from"./headers-3957187b.js";import{e as l}from"./Button-0a6df741.js";import"./Icon-f0586d91.js";import"./light-ba0aba9c.js";const E={class:"container"},H={class:"inside"},P={__name:"CartView",setup(A){const y=v(),f=q(),{editCart:g}=f,_=async(t,e)=>{await g({_id:a[t].p_id,quantity:e}),a[t].quantity+=e,a[t].quantity<=0&&a.splice(t,1)},k=p(()=>a.reduce((t,e)=>t+e.quantity*e.price,0)),h=p(()=>a.length>0&&!a.some(t=>!t.sell));(async()=>{var t,e;try{const{data:s}=await b.get("/users/cart");for(const r of s.result)a.push({_id:r._id,p_id:r.p_id._id,category:r.p_id.category,description:r.description,images:r.p_id.images,name:r.p_id.name,price:r.p_id.price,sell:r.p_id.sell,quantity:r.quantity,key:r._id})}catch(s){y.error({title:"失敗",content:((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"取得購物車失敗",positiveText:"再試一次"})}})();const a=m([]),C=m([{title:"",key:"image",render(t,e){return o("img",{src:a[e].images[0],height:80})}},{title:"商品",key:"name",render(t,e){return o(u,{to:"shop/products/"+a[e].p_id,style:"color: #FFF; text-decoration: none;"},{default:()=>a[e].name})}},{title:"單價",key:"price"},{title:"",key:"-",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,-1)},{default:()=>"-"})}},{title:"數量",key:"quantity"},{title:"",key:"+",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,1)},{default:()=>"+"})}},{title:"小計",key:"productTotalPrice",render(t,e){return o("p",{},{default:()=>t.price*t.quantity})}},{title:"",key:"delete",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,a[e].quantity*-1)},{default:()=>"刪除"})}}]);return(t,e)=>{const s=L,r=x,w=F,N=S;return B(),D("div",E,[T("div",H,[n(s,{class:"pageTitle"},{default:i(()=>[d(" 購物車 ")]),_:1}),n(r),n(w,{columns:C,data:a},null,8,["columns","data"]),n(N,{style:{"align-self":"flex-end"}},{default:i(()=>[d(" 結帳金額：$"+z(c(k)),1)]),_:1}),n(c(u),{to:"/orderbuild",style:{"align-self":"flex-end"}},{default:i(()=>[n(c(l),{disabled:!c(h),type:"primary"},{default:i(()=>[d(" 前往結帳 ")]),_:1},8,["disabled"])]),_:1})])])}}},$=V(P,[["__scopeId","data-v-f3947c04"]]);export{$ as default};
