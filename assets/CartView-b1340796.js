import{P as v,R as N,Z as q,D as x}from"./router-695404e9.js";import{ad as u}from"./vue-router-c479bf20.js";import{b6 as V,I as p,ab as m,af as B,a_ as D,a$ as T,ai as n,ah as i,aj as c,r as o,b8 as d,bb as z}from"./plugin-vueexport-helper-93ca072e.js";import{_ as F}from"./DataTable-c941df54.js";import{c as P,N as H}from"./headers-4ec1fbe9.js";import{N as l}from"./Button-a9e134a7.js";import"./Icon-d2f7755d.js";import"./light-63842926.js";const I={class:"container"},R={class:"inside"},S={__name:"CartView",setup($){const y=v(),f=N(),{editCart:g}=f,_=async(t,e)=>{await g({_id:a[t].p_id,quantity:e}),a[t].quantity+=e,a[t].quantity<=0&&a.splice(t,1)},h=p(()=>a.reduce((t,e)=>t+e.quantity*e.price,0)),k=p(()=>a.length>0&&!a.some(t=>!t.sell));(async()=>{var t,e;try{const{data:s}=await q.get("/users/cart");for(const r of s.result)a.push({_id:r._id,p_id:r.p_id._id,category:r.p_id.category,description:r.description,images:r.p_id.images,name:r.p_id.name,price:r.p_id.price,sell:r.p_id.sell,quantity:r.quantity,key:r._id})}catch(s){y.error({title:"失敗",content:((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"取得購物車失敗",positiveText:"再試一次"})}})();const a=m([]),b=m([{title:"",key:"image",render(t,e){return o("img",{src:a[e].images[0],height:80})}},{title:"商品",key:"name",render(t,e){return o(u,{to:"shop/products/"+a[e].p_id,style:"color: #FFF; text-decoration: none;"},{default:()=>a[e].name})}},{title:"單價",key:"price"},{title:"",key:"-",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,-1)},{default:()=>"-"})}},{title:"數量",key:"quantity"},{title:"",key:"+",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,1)},{default:()=>"+"})}},{title:"小計",key:"productTotalPrice",render(t,e){return o("p",{},{default:()=>t.price*t.quantity})}},{title:"",key:"delete",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,a[e].quantity*-1)},{default:()=>"刪除"})}}]);return(t,e)=>{const s=P,r=x,C=F,w=H;return B(),D("div",I,[T("div",R,[n(s,{class:"pageTitle"},{default:i(()=>[d(" 購物車 ")]),_:1}),n(r),n(C,{columns:b,data:a},null,8,["columns","data"]),n(w,{style:{"align-self":"flex-end"}},{default:i(()=>[d(" 結帳金額：$"+z(c(h)),1)]),_:1}),n(c(u),{to:"/orderbuild",style:{"align-self":"flex-end"}},{default:i(()=>[n(c(l),{disabled:!c(k),type:"primary"},{default:i(()=>[d(" 前往結帳 ")]),_:1},8,["disabled"])]),_:1})])])}}},K=V(S,[["__scopeId","data-v-f3947c04"]]);export{K as default};
