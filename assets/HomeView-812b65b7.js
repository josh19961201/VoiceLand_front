import{B as C,C as T,S as f,K as V,L as H,P as I,J as L}from"./router-079c6ebf.js";import{aL as D,j as g,G as M,K as R,aD as U,N as l,M as i,aM as p,aE as h,aO as j,aP as q}from"./plugin-vueexport-helper-7abb35e5.js";import{_ as A}from"./Upload-c8e3be0f.js";import{N as E}from"./headers-04aa7c74.js";import{e as F}from"./Button-4159ae6a.js";import"./vue-router-23be1caa.js";import"./Icon-085b31e9.js";import"./Warning-747f8a56.js";import"./light-3a781827.js";import"./Image-dd5f112e.js";const G=_=>(j("data-v-a8a25e61"),_=_(),q(),_),K={class:"container"},P=G(()=>h("br",null,null,-1)),z={class:"btnGroup"},J={__name:"HomeView",setup(_){const m=C(),y=T(),u=g(!1),w={intro:{required:!0,message:"請輸入介紹文字"}},v=g(null),a=M({intro:"",banners:[]}),x=async()=>{var s,n;try{const{data:e}=await f.get("/intro");a.intro=e.result[0].intro,c.value.push(...e.result[0].banners.map((t,r)=>({id:r.toString(),name:r.toString(),status:"finished",url:t}))),a.banners=c.value}catch(e){console.log(e),m.error({title:"載入失敗",content:((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"發生錯誤",positiveText:"確認"})}},c=g([]),S=s=>{let n=[],e=[];n=s.fileList.map(t=>t.url).filter(t=>t!==null),e=s.fileList.map(t=>t.file).filter(t=>t!==null),a.banners=[...n,...e]},B=async()=>{var s;(s=v.value)==null||s.validate(async n=>{var e,t;if(n)y.error("請檢查資料是否完整"),u.value=!1;else{const r=new FormData;r.append("intro",a.intro),a.banners=a.banners.map(o=>o.url?o.url:o);for(const o of a.banners)r.append("banners",o);try{u.value=!0,await f.patch("/intro",r),m.success({title:"編輯成功",content:"首頁資訊編輯成功",positiveText:"確認"}),u.value=!1}catch(o){m.error({title:"新增失敗",content:((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"}),console.log(o),u.value=!1}u.value=!1}})};return(async()=>{var s,n;try{const{data:e}=await f.get("/intro");a.intro=e.result[0].intro,c.value.push(...e.result[0].banners.map((t,r)=>({id:r.toString(),name:r.toString(),status:"finished",url:t}))),a.banners=c.value}catch(e){console.log(e),m.error({title:"載入失敗",content:((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"發生錯誤",positiveText:"確認"})}})(),(s,n)=>{const e=E,t=H,r=I,o=L,N=A,b=F,k=V;return R(),U("div",K,[l(e,{class:"pageTitle"},{default:i(()=>[p(" 首頁管理 ")]),_:1}),l(t),l(k,{ref_key:"fromRef",ref:v,rules:w,model:a,"show-require-mark":!1,class:"form"},{default:i(()=>[l(o,{label:"About Us",path:"intro"},{default:i(()=>[l(r,{value:a.intro,"onUpdate:value":n[0]||(n[0]=d=>a.intro=d),type:"textarea",autosize:{minRows:10},placeholder:"請輸入介紹文字"},null,8,["value"])]),_:1}),l(o,{label:"Banner",path:"banners"},{default:i(()=>[l(N,{value:a.banners,"onUpdate:value":n[1]||(n[1]=d=>a.banners=d),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":c.value,multiple:!0,max:5,onChange:S},{default:i(()=>[p(" 建議大小 "),P,p(" 1920 * 1080 ")]),_:1},8,["value","default-file-list"])]),_:1}),h("div",z,[l(b,{onClick:x},{default:i(()=>[p(" 取消 ")]),_:1}),l(b,{loading:u.value,type:"primary",onClick:B},{default:i(()=>[p(" 修改 ")]),_:1},8,["loading"])])]),_:1},8,["model"])])}}},ae=D(J,[["__scopeId","data-v-a8a25e61"]]);export{ae as default};
