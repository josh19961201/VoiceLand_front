import{C as W,B as z,a8 as x,S as y,P,X as A,F as G,K as Q,_ as X,L as $,I as J}from"./router-079c6ebf.js";import{aL as Z,j as b,G as U,K as ee,aD as te,N as a,M as o,O as Y,F as ae,aM as g,aE as ne,aQ as le,h as C}from"./plugin-vueexport-helper-7abb35e5.js";import{N as oe}from"./headers-04aa7c74.js";import{_ as se}from"./_common-4b455c47.js";import{_ as ie}from"./DataTable-ad652812.js";import{e as D}from"./Button-4159ae6a.js";import{_ as pe}from"./FormItemGridItem-2a2f8f39.js";import{_ as re}from"./Switch-ac13d8cd.js";import{_ as ue,a as de}from"./DynamicInput-d81aeb53.js";import{_ as _e}from"./Upload-c8e3be0f.js";import"./vue-router-23be1caa.js";import"./Icon-085b31e9.js";import"./Warning-747f8a56.js";import"./light-1cb1544e.js";import"./_common-a3731a7a.js";import"./Remove-f72efb46.js";import"./light-3a781827.js";import"./Image-dd5f112e.js";const me={__name:"WorksView",setup(ce){const F=W(),_=z(),w=b(!1),m=b([]),M={image:{required:!0,message:"請上傳圖片"},title:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},date:{},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},artist:{required:!0,message:"請選擇作品者"}},N=[{label:"Sabrina Band",value:"Sabrina Band"},{label:"Coastal Kanpai",value:"Coastal Kanpai"},{label:"Yellow Flower",value:"Yellow Flower"},{label:"Faye Hong",value:"Faye Hong"}],V=[{label:"YouTube",value:"yt"},{label:"StreetVoice",value:"sv"},{label:"Spotify",value:"st"},{label:"Else",value:"else"}],B=()=>({linkType:"",link:""}),h=b(null),p=U([]),e=U({_id:"",image:[],title:"",date:x().format("YYYY.MM.DD"),description:"",display:!1,artist:[],links:[],dialog:!1,idx:-1}),T=n=>{n===-1?(e._id="",e.image=[],e.title="",e.date=x().format("YYYY.MM.DD"),e.description="",e.display=!1,e.artist=[],e.links=[],e.dialog=!1,e.idx=-1):(e._id=p[n]._id,e.title=p[n].title,e.date=p[n].date,e.description=p[n].description,e.display=p[n].display,e.artist=p[n].artist,e.links=p[n].links,e.dialog=p[n].dialog,e.idx=n,m.value.push({id:"001",name:"image",status:"finished",url:p[n].image}),e.image=m.value),e.dialog=!0},j=n=>{var t,s;e.image=(s=(t=n.fileList)==null?void 0:t[0])==null?void 0:s.file},f=()=>{m.value=[],e.dialog=!1},S=async()=>{var n;return(n=h.value)==null||n.validate(async t=>{var s,d,u;if(t)F.error("請檢查資料是否完整");else{const r=new FormData;(s=e.image[0])!=null&&s.url&&(e.image=e.image[0].url),r.append("image",e.image),r.append("title",e.title),r.append("date",e.date),r.append("description",e.description),r.append("display",e.display),r.append("artist",e.artist),e.links=e.links.map(i=>{const v=i.linkType,c=i.link;return{linkType:v,link:c}});for(const i of e.links)r.append("linksType",Object.entries(i)[0][1]),r.append("linksValue",Object.entries(i)[1][1]);try{if(e._id.length===0){const{data:i}=await y.post("/works",r);p.push(i.result),_.success({title:"新增成功",content:"作品活動新增成功",positiveText:"確認"}),f()}else{const{data:i}=await y.patch("/works/"+e._id,r);p[e.idx]=i.result,_.success({title:"編輯成功",content:"作品資訊編輯成功",positiveText:"確認"}),f()}e.dialog=!1}catch(i){_.error({title:"新增失敗",content:((u=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:u.message)||"發生錯誤",positiveText:"確認"}),console.log(i)}w.value=!1}}),!1};(async()=>{var n,t;try{const{data:s}=await y.get("/works/all");p.push(...s.result)}catch(s){_.error({title:"載入失敗",content:((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const q=(({edit:n})=>[{title:"作品名稱",key:"title"},{title:"日期",key:"date"},{title:"演出者",key:"artist",render(t,s){return C(J,{},{default:()=>t.artist})}},{title:"",key:"edit",render(t,s){return C(D,{strong:!0,tertiary:!0,size:"small",onClick:()=>n(t,s)},{default:()=>"編輯"})}}])({edit(n,t){T(t)}});return(n,t)=>{const s=oe,d=P,u=pe,r=re,i=ue,v=_e,c=A,K=de,L=G,R=Q,E=X,H=se,I=$,O=ie;return ee(),te(ae,null,[a(s,{class:"pageTitle"},{default:o(()=>[g(" 作品管理 ")]),_:1}),a(Y(D),{onClick:t[0]||(t[0]=l=>T(-1))},{default:o(()=>[g(" 新增作品 ")]),_:1}),a(H,{show:e.dialog,"onUpdate:show":t[8]||(t[8]=l=>e.dialog=l),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":f,"on-positive-click":S,closable:!1,loading:w.value},{header:o(()=>[ne("div",null,le(e._id.length>0?"編輯作品":"新增作品"),1)]),default:o(()=>[a(E,null,{default:o(()=>[a(R,{ref_key:"fromRef",ref:h,rules:M,model:e},{default:o(()=>[a(L,{cols:12,"x-gap":12},{default:o(()=>[a(u,{span:10,label:"作品名稱",path:"title"},{default:o(()=>[a(d,{value:e.title,"onUpdate:value":t[1]||(t[1]=l=>e.title=l),placeholder:"請輸入作品名稱"},null,8,["value"])]),_:1}),a(u,{span:2,label:"公開",path:"display"},{default:o(()=>[a(r,{value:e.display,"onUpdate:value":t[2]||(t[2]=l=>e.display=l)},null,8,["value"])]),_:1}),a(u,{span:6,label:"作品日期",path:"date"},{default:o(()=>[a(i,{"formatted-value":e.date,"onUpdate:formatted-value":t[3]||(t[3]=l=>e.date=l),"value-format":"yyyy.MM.dd",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),a(u,{span:6,label:"圖片",path:"image"},{default:o(()=>[a(v,{value:e.image,"onUpdate:value":t[4]||(t[4]=l=>e.image=l),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,max:1,onChange:j},{default:o(()=>[g(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1}),a(u,{span:12,label:"演出者",path:"artist"},{default:o(()=>[a(c,{value:e.artist,"onUpdate:value":t[5]||(t[5]=l=>e.artist=l),options:N,"show-checkmark":!1},null,8,["value"])]),_:1}),a(u,{span:12,label:"作品資訊",path:"description"},{default:o(()=>[a(d,{value:e.description,"onUpdate:value":t[6]||(t[6]=l=>e.description=l),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這個作品有多酷！"},null,8,["value"])]),_:1}),a(u,{span:12,label:"外部連結",path:"links"},{default:o(()=>[a(K,{value:e.links,"onUpdate:value":t[7]||(t[7]=l=>e.links=l),"on-create":B},{"create-button-default":o(()=>[g(" 加入外部連結 ")]),default:o(({value:l})=>[a(c,{value:l.linkType,"onUpdate:value":k=>l.linkType=k,options:V},null,8,["value","onUpdate:value"]),a(d,{value:l.link,"onUpdate:value":k=>l.link=k,type:"text",placeholder:"請輸入連結"},null,8,["value","onUpdate:value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),a(I),a(O,{columns:Y(q),data:p},null,8,["columns","data"])],64)}}},je=Z(me,[["__scopeId","data-v-cd5f2f66"]]);export{je as default};
