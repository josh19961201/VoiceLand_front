import{C as z,B as A,S as g,P as H,W as I,F as P,K as $,_ as G,L as K}from"./router-ae37ba64.js";import{_ as M}from"./_common-f8f0b77c.js";import{_ as Q}from"./Switch-142980e5.js";import{l as f,n as b,D as W,aD as J,H as n,G as i,I as w,F as O,aN as v,aE as X,aQ as Y,j as Z}from"./plugin-vueexport-helper-f05f1187.js";import{c as ee}from"./headers-9e312c4a.js";import{_ as te}from"./DataTable-e597766d.js";import{e as k}from"./Button-336cb67e.js";import{_ as ae}from"./FormItemGridItem-cc9c6eac.js";import{_ as ne}from"./InputNumber-a9573a3a.js";import{_ as oe}from"./Upload-50960d90.js";import"./vue-router-3b4314f2.js";import"./Icon-b714c065.js";import"./Warning-bf9fec98.js";import"./light-fe558375.js";import"./Remove-d078d79f.js";import"./light-e0640ca2.js";import"./Image-f946f3c9.js";const Ce={__name:"ProductsView",setup(se){const x=z(),c=A(),_=f(!1),m=f([]),C={name:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},price:{type:"number",required:!0,validator(a,t){if(t){if(!/^[1-9]\d*$/.test(t))return new Error("請輸入正整數")}else return new Error("請輸入售價");return!0},trigger:["input","blur"]},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},images:{required:!0,message:"請上傳圖片"},category:{required:!0,message:"請選擇分類"}},D=[{label:"Clothing",value:"clothing"},{label:"Rechords",value:"rechords"},{label:"Accessories",value:"accessories"}],y=f(null),u=b([]),e=b({_id:"",name:"",price:0,description:"",images:[],sell:!1,category:"",dialog:!1,idx:-1}),h=a=>{a===-1?(e._id="",e.name="",e.price=0,e.description="",e.images=[],e.sell=!1,e.category="",e.idx=-1):(e._id=u[a]._id,e.name=u[a].name,e.price=u[a].price,e.description=u[a].description,e.sell=u[a].sell,e.category=u[a].category,e.idx=a,m.value.push(...u[a].images.map((t,o)=>({id:o.toString(),name:o.toString(),status:"finished",url:t}))),e.images=m.value),e.dialog=!0},U=a=>{let t=[],o=[];t=a.fileList.map(p=>p.url).filter(p=>p!==null),o=a.fileList.map(p=>p.file).filter(p=>p!==null),e.images=[...t,...o]},d=()=>{m.value=[],e.dialog=!1},F=async()=>{var a;return(a=y.value)==null||a.validate(async t=>{var o,p;if(t)x.error("請檢查資料是否完整");else{_.value=!0;const l=new FormData;l.append("name",e.name),l.append("price",e.price),l.append("description",e.description),l.append("sell",e.sell),l.append("category",e.category),e.images=e.images.map(s=>s.url?s.url:s);for(const s of e.images)l.append("images",s);try{if(e._id.length===0){const{data:s}=await g.post("/products",l);u.push(s.result),c.success({title:"新增成功",content:"商品新增成功",positiveText:"確認"}),d()}else{const{data:s}=await g.patch("/products/"+e._id,l);u[e.idx]=s.result,c.success({title:"編輯成功",content:"商品編輯成功",positiveText:"確認"}),d()}e.dialog=!1}catch(s){c.error({title:"新增失敗",content:((p=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:p.message)||"發生錯誤",positiveText:"確認"}),console.log(s)}_.value=!1}}),!1};(async()=>{var a,t;try{const{data:o}=await g.get("/products/all");u.push(...o.result)}catch(o){c.error({title:"載入失敗",content:((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const N=(({edit:a})=>[{title:"商品",key:"name"},{title:"售價",key:"price"},{title:"分類",key:"category"},{title:"",key:"edit",render(t,o){return Z(k,{strong:!0,tertiary:!0,size:"small",onClick:()=>a(t,o)},{default:()=>"編輯"})}}])({edit(a,t){h(t)}});return(a,t)=>{const o=ee,p=H,l=ae,s=Q,T=ne,q=I,B=oe,R=P,E=$,S=G,V=M,L=K,j=te;return W(),J(O,null,[n(o,{class:"pageTitle"},{default:i(()=>[v(" 商品管理 ")]),_:1}),n(w(k),{onClick:t[0]||(t[0]=r=>h(-1))},{default:i(()=>[v(" 新增商品 ")]),_:1}),n(V,{show:e.dialog,"onUpdate:show":t[7]||(t[7]=r=>e.dialog=r),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":d,"on-positive-click":F,closable:!1,loading:_.value},{header:i(()=>[X("div",null,Y(e._id.length>0?"編輯商品":"新增商品"),1)]),default:i(()=>[n(S,null,{default:i(()=>[n(E,{ref_key:"formRef",ref:y,rules:C,model:e},{default:i(()=>[n(R,{cols:12,"x-gap":12},{default:i(()=>[n(l,{span:10,label:"商品名稱",path:"name"},{default:i(()=>[n(p,{value:e.name,"onUpdate:value":t[1]||(t[1]=r=>e.name=r),placeholder:"給商品取個名字吧！"},null,8,["value"])]),_:1}),n(l,{span:2,label:"上架",path:"sell"},{default:i(()=>[n(s,{value:e.sell,"onUpdate:value":t[2]||(t[2]=r=>e.sell=r)},null,8,["value"])]),_:1}),n(l,{span:6,label:"商品售價",path:"price"},{default:i(()=>[n(T,{value:e.price,"onUpdate:value":t[3]||(t[3]=r=>e.price=r),placeholder:"賣多少錢？"},null,8,["value"])]),_:1}),n(l,{span:6,label:"商品分類",path:"category"},{default:i(()=>[n(q,{value:e.category,"onUpdate:value":t[4]||(t[4]=r=>e.category=r),options:D,"show-checkmark":!1},null,8,["value"])]),_:1}),n(l,{span:12,label:"商品說明",path:"description"},{default:i(()=>[n(p,{value:e.description,"onUpdate:value":t[5]||(t[5]=r=>e.description=r),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這個商品有多酷！"},null,8,["value"])]),_:1}),n(l,{span:12,label:"商品圖片",path:"images"},{default:i(()=>[n(B,{value:e.images,"onUpdate:value":t[6]||(t[6]=r=>e.images=r),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,multiple:!0,max:12,onChange:U},{default:i(()=>[v(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),n(L),n(j,{columns:w(N),data:u},null,8,["columns","data"])],64)}}};export{Ce as default};
