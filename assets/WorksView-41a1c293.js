import{G as K,F as O,a3 as x,P as y,_ as P,T as A,z as G,L as J,a4 as X}from"./router-541adf43.js";import{b3 as $,J as b,a8 as U,ad as Q,aX as Z,ag as a,af as o,ah as Y,a7 as ee,b5 as g,aY as te,b8 as ae,r as C}from"./_plugin-vue_export-helper-0effeee0.js";import{c as ne}from"./headers-b2d32875.js";import{_ as le}from"./light-4c2c7a52.js";import{_ as oe}from"./DataTable-17e19d67.js";import{N as D,n as se,_ as ie}from"./Divider-ea7a148e.js";import{_ as pe}from"./FormItemGridItem-5b3202e8.js";import{_ as re}from"./Switch-c0877c40.js";import{_ as ue,a as de}from"./DynamicInput-48135f05.js";import{_ as _e}from"./Upload-d053081d.js";import"./PersonOutline-c658c387.js";import"./Icon-c6deeddd.js";import"./light-6f693426.js";import"./light-1cf01424.js";import"./light-31f1c4f8.js";import"./Remove-ea49db6b.js";import"./Image-18d9eb91.js";import"./light-07f515f4.js";const me={__name:"WorksView",setup(ce){const F=K(),_=O(),w=b(!1),m=b([]),V={image:{required:!0,message:"請上傳圖片"},title:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},date:{},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},artist:{required:!0,message:"請選擇作品者"}},M=[{label:"Sabrina Band",value:"Sabrina Band"},{label:"Coastal Kanpai",value:"Coastal Kanpai"},{label:"Yellow Flower",value:"Yellow Flower"},{label:"Faye Hong",value:"Faye Hong"}],N=[{label:"YouTube",value:"yt"},{label:"StreetVoice",value:"sv"},{label:"Spotify",value:"st"},{label:"Else",value:"else"}],B=()=>({linkType:"",link:""}),h=b(null),p=U([]),e=U({_id:"",image:[],title:"",date:x().format("YYYY.MM.DD"),description:"",display:!1,artist:[],links:[],dialog:!1,idx:-1}),T=n=>{n===-1?(e._id="",e.image=[],e.title="",e.date=x().format("YYYY.MM.DD"),e.description="",e.display=!1,e.artist=[],e.links=[],e.dialog=!1,e.idx=-1):(e._id=p[n]._id,e.title=p[n].title,e.date=p[n].date,e.description=p[n].description,e.display=p[n].display,e.artist=p[n].artist,e.links=p[n].links,e.dialog=p[n].dialog,e.idx=n,m.value.push({id:"001",name:"image",status:"finished",url:p[n].image}),e.image=m.value),e.dialog=!0},j=n=>{var t,s;e.image=(s=(t=n.fileList)==null?void 0:t[0])==null?void 0:s.file},f=()=>{m.value=[],e.dialog=!1},S=async()=>{var n;return(n=h.value)==null||n.validate(async t=>{var s,d,u;if(t)F.error("請檢查資料是否完整");else{const r=new FormData;(s=e.image[0])!=null&&s.url&&(e.image=e.image[0].url),r.append("image",e.image),r.append("title",e.title),r.append("date",e.date),r.append("description",e.description),r.append("display",e.display),r.append("artist",e.artist),e.links=e.links.map(i=>{const v=i.linkType,c=i.link;return{linkType:v,link:c}});for(const i of e.links)r.append("linksType",Object.entries(i)[0][1]),r.append("linksValue",Object.entries(i)[1][1]);try{if(e._id.length===0){const{data:i}=await y.post("/works",r);p.push(i.result),_.success({title:"新增成功",content:"作品活動新增成功",positiveText:"確認"}),f()}else{const{data:i}=await y.patch("/works/"+e._id,r);p[e.idx]=i.result,_.success({title:"編輯成功",content:"作品資訊編輯成功",positiveText:"確認"}),f()}e.dialog=!1}catch(i){_.error({title:"新增失敗",content:((u=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:u.message)||"發生錯誤",positiveText:"確認"}),console.log(i)}w.value=!1}}),!1};(async()=>{var n,t;try{const{data:s}=await y.get("/works/all");p.push(...s.result)}catch(s){_.error({title:"載入失敗",content:((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const q=(({edit:n})=>[{title:"作品名稱",key:"title"},{title:"日期",key:"date"},{title:"演出者",key:"artist",render(t,s){return C(X,{},{default:()=>t.artist})}},{title:"",key:"edit",render(t,s){return C(D,{strong:!0,tertiary:!0,size:"small",onClick:()=>n(t,s)},{default:()=>"編輯"})}}])({edit(n,t){T(t)}});return(n,t)=>{const s=ne,d=P,u=pe,r=re,i=ue,v=_e,c=A,R=de,z=G,H=J,L=se,W=le,E=ie,I=oe;return Q(),Z(ee,null,[a(s,{class:"pageTitle"},{default:o(()=>[g(" 作品管理 ")]),_:1}),a(Y(D),{onClick:t[0]||(t[0]=l=>T(-1))},{default:o(()=>[g(" 新增作品 ")]),_:1}),a(W,{show:e.dialog,"onUpdate:show":t[8]||(t[8]=l=>e.dialog=l),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":f,"on-positive-click":S,closable:!1,loading:w.value},{header:o(()=>[te("div",null,ae(e._id.length>0?"編輯作品":"新增作品"),1)]),default:o(()=>[a(L,null,{default:o(()=>[a(H,{ref_key:"fromRef",ref:h,rules:V,model:e},{default:o(()=>[a(z,{cols:12,"x-gap":12},{default:o(()=>[a(u,{span:10,label:"作品名稱",path:"title"},{default:o(()=>[a(d,{value:e.title,"onUpdate:value":t[1]||(t[1]=l=>e.title=l),placeholder:"請輸入作品名稱"},null,8,["value"])]),_:1}),a(u,{span:2,label:"公開",path:"display"},{default:o(()=>[a(r,{value:e.display,"onUpdate:value":t[2]||(t[2]=l=>e.display=l)},null,8,["value"])]),_:1}),a(u,{span:6,label:"作品日期",path:"date"},{default:o(()=>[a(i,{"formatted-value":e.date,"onUpdate:formatted-value":t[3]||(t[3]=l=>e.date=l),"value-format":"yyyy.MM.dd",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),a(u,{span:6,label:"圖片",path:"image"},{default:o(()=>[a(v,{value:e.image,"onUpdate:value":t[4]||(t[4]=l=>e.image=l),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,max:1,onChange:j},{default:o(()=>[g(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1}),a(u,{span:12,label:"演出者",path:"artist"},{default:o(()=>[a(c,{value:e.artist,"onUpdate:value":t[5]||(t[5]=l=>e.artist=l),options:M,"show-checkmark":!1},null,8,["value"])]),_:1}),a(u,{span:12,label:"作品資訊",path:"description"},{default:o(()=>[a(d,{value:e.description,"onUpdate:value":t[6]||(t[6]=l=>e.description=l),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這個作品有多酷！"},null,8,["value"])]),_:1}),a(u,{span:12,label:"外部連結",path:"links"},{default:o(()=>[a(R,{value:e.links,"onUpdate:value":t[7]||(t[7]=l=>e.links=l),"on-create":B},{"create-button-default":o(()=>[g(" 加入外部連結 ")]),default:o(({value:l})=>[a(c,{value:l.linkType,"onUpdate:value":k=>l.linkType=k,options:N},null,8,["value","onUpdate:value"]),a(d,{value:l.link,"onUpdate:value":k=>l.link=k,type:"text",placeholder:"請輸入連結"},null,8,["value","onUpdate:value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),a(E),a(I,{columns:Y(q),data:p},null,8,["columns","data"])],64)}}},je=$(me,[["__scopeId","data-v-cd5f2f66"]]);export{je as default};
