import{Q as L,P as O,ad as U,Z as y,_ as P,a2 as $,E as A,W as Q,K as Z,D as G,U as J}from"./router-695404e9.js";import{b6 as X,E as b,ab as x,af as ee,a_ as te,ai as a,ah as o,aj as Y,aa as ae,b8 as f,a$ as ne,bb as le,r as D}from"./plugin-vueexport-helper-93ca072e.js";import{c as oe}from"./headers-4ec1fbe9.js";import{_ as se}from"./light-aa94e066.js";import{_ as ie}from"./DataTable-c941df54.js";import{N as C}from"./Button-a9e134a7.js";import{_ as pe}from"./FormItemGridItem-4662173a.js";import{_ as re}from"./Switch-09ec83c1.js";import{_ as ue,a as de}from"./DynamicInput-0b25381c.js";import{_ as _e}from"./Upload-0e5b9722.js";import"./vue-router-c479bf20.js";import"./Icon-d2f7755d.js";import"./Warning-59bfeccf.js";import"./light-63842926.js";import"./light-4275cd65.js";import"./Remove-353a4c3c.js";import"./light-11280528.js";import"./Image-170dd4b6.js";import"./light-f5dd8080.js";const me={__name:"WorksView",setup(ce){const F=L(),_=O(),w=b(!1),m=b([]),V={image:{required:!0,message:"請上傳圖片"},title:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},date:{},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},artist:{required:!0,message:"請選擇作品者"}},M=[{label:"Sabrina Band",value:"Sabrina Band"},{label:"Coastal Kanpai",value:"Coastal Kanpai"},{label:"Yellow Flower",value:"Yellow Flower"},{label:"Faye Hong",value:"Faye Hong"}],N=[{label:"YouTube",value:"yt"},{label:"StreetVoice",value:"sv"},{label:"Spotify",value:"st"},{label:"Else",value:"else"}],j=()=>({linkType:"",link:""}),h=b(null),p=x([]),e=x({_id:"",image:[],title:"",date:U().format("YYYY.MM.DD"),description:"",display:!1,artist:[],links:[],dialog:!1,idx:-1}),T=n=>{n===-1?(e._id="",e.image=[],e.title="",e.date=U().format("YYYY.MM.DD"),e.description="",e.display=!1,e.artist=[],e.links=[],e.dialog=!1,e.idx=-1):(e._id=p[n]._id,e.title=p[n].title,e.date=p[n].date,e.description=p[n].description,e.display=p[n].display,e.artist=p[n].artist,e.links=p[n].links,e.dialog=p[n].dialog,e.idx=n,m.value.push({id:"001",name:"image",status:"finished",url:p[n].image}),e.image=m.value),e.dialog=!0},B=n=>{var t,s;e.image=(s=(t=n.fileList)==null?void 0:t[0])==null?void 0:s.file},g=()=>{m.value=[],e.dialog=!1},S=async()=>{var n;return(n=h.value)==null||n.validate(async t=>{var s,d,u;if(t)F.error("請檢查資料是否完整");else{const r=new FormData;(s=e.image[0])!=null&&s.url&&(e.image=e.image[0].url),r.append("image",e.image),r.append("title",e.title),r.append("date",e.date),r.append("description",e.description),r.append("display",e.display),r.append("artist",e.artist),e.links=e.links.map(i=>{const v=i.linkType,c=i.link;return{linkType:v,link:c}});for(const i of e.links)r.append("linksType",Object.entries(i)[0][1]),r.append("linksValue",Object.entries(i)[1][1]);try{if(e._id.length===0){const{data:i}=await y.post("/works",r);p.push(i.result),_.success({title:"新增成功",content:"作品活動新增成功",positiveText:"確認"}),g()}else{const{data:i}=await y.patch("/works/"+e._id,r);p[e.idx]=i.result,_.success({title:"編輯成功",content:"作品資訊編輯成功",positiveText:"確認"}),g()}e.dialog=!1}catch(i){_.error({title:"新增失敗",content:((u=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:u.message)||"發生錯誤",positiveText:"確認"}),console.log(i)}w.value=!1}}),!1};(async()=>{var n,t;try{const{data:s}=await y.get("/works/all");p.push(...s.result)}catch(s){_.error({title:"載入失敗",content:((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const q=(({edit:n})=>[{title:"作品名稱",key:"title"},{title:"日期",key:"date"},{title:"演出者",key:"artist",render(t,s){return D(J,{},{default:()=>t.artist})}},{title:"",key:"edit",render(t,s){return D(C,{strong:!0,tertiary:!0,size:"small",onClick:()=>n(t,s)},{default:()=>"編輯"})}}])({edit(n,t){T(t)}});return(n,t)=>{const s=oe,d=P,u=pe,r=re,i=ue,v=_e,c=$,E=de,R=A,W=Q,H=Z,K=se,z=G,I=ie;return ee(),te(ae,null,[a(s,{class:"pageTitle"},{default:o(()=>[f(" 作品管理 ")]),_:1}),a(Y(C),{onClick:t[0]||(t[0]=l=>T(-1))},{default:o(()=>[f(" 新增作品 ")]),_:1}),a(K,{show:e.dialog,"onUpdate:show":t[8]||(t[8]=l=>e.dialog=l),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":g,"on-positive-click":S,closable:!1,loading:w.value},{header:o(()=>[ne("div",null,le(e._id.length>0?"編輯作品":"新增作品"),1)]),default:o(()=>[a(H,null,{default:o(()=>[a(W,{ref_key:"fromRef",ref:h,rules:V,model:e},{default:o(()=>[a(R,{cols:12,"x-gap":12},{default:o(()=>[a(u,{span:10,label:"作品名稱",path:"title"},{default:o(()=>[a(d,{value:e.title,"onUpdate:value":t[1]||(t[1]=l=>e.title=l),placeholder:"請輸入作品名稱"},null,8,["value"])]),_:1}),a(u,{span:2,label:"公開",path:"display"},{default:o(()=>[a(r,{value:e.display,"onUpdate:value":t[2]||(t[2]=l=>e.display=l)},null,8,["value"])]),_:1}),a(u,{span:6,label:"作品日期",path:"date"},{default:o(()=>[a(i,{"formatted-value":e.date,"onUpdate:formatted-value":t[3]||(t[3]=l=>e.date=l),"value-format":"yyyy.MM.dd",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),a(u,{span:6,label:"圖片",path:"image"},{default:o(()=>[a(v,{value:e.image,"onUpdate:value":t[4]||(t[4]=l=>e.image=l),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,max:1,onChange:B},{default:o(()=>[f(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1}),a(u,{span:12,label:"演出者",path:"artist"},{default:o(()=>[a(c,{value:e.artist,"onUpdate:value":t[5]||(t[5]=l=>e.artist=l),options:M,"show-checkmark":!1},null,8,["value"])]),_:1}),a(u,{span:12,label:"作品資訊",path:"description"},{default:o(()=>[a(d,{value:e.description,"onUpdate:value":t[6]||(t[6]=l=>e.description=l),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這個作品有多酷！"},null,8,["value"])]),_:1}),a(u,{span:12,label:"外部連結",path:"links"},{default:o(()=>[a(E,{value:e.links,"onUpdate:value":t[7]||(t[7]=l=>e.links=l),"on-create":j},{"create-button-default":o(()=>[f(" 加入外部連結 ")]),default:o(({value:l})=>[a(c,{value:l.linkType,"onUpdate:value":k=>l.linkType=k,options:N},null,8,["value","onUpdate:value"]),a(d,{value:l.link,"onUpdate:value":k=>l.link=k,type:"text",placeholder:"請輸入連結"},null,8,["value","onUpdate:value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),a(z),a(I,{columns:Y(q),data:p},null,8,["columns","data"])],64)}}},Se=X(me,[["__scopeId","data-v-cd5f2f66"]]);export{Se as default};
