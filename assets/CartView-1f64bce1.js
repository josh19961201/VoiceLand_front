import{F as v,H as N,P as q}from"./router-48bdd7c6.js";import{a8 as u}from"./PersonOutline-bba22013.js";import{b3 as x,K as p,a8 as m,ad as V,aX as B,aY as F,ag as n,af as i,ah as c,r as o,b5 as d,b8 as T}from"./plugin-vueexport-helper-0effeee0.js";import{_ as z}from"./DataTable-4e86d937.js";import{c as D,N as H}from"./headers-888afa08.js";import{N as l,_ as P}from"./Divider-ab21959c.js";import"./Icon-e4f27f28.js";import"./light-d52df429.js";const S={class:"container"},A={class:"inside"},E={__name:"CartView",setup(I){const y=v(),f=N(),{editCart:g}=f,_=async(t,e)=>{await g({_id:a[t].p_id,quantity:e}),a[t].quantity+=e,a[t].quantity<=0&&a.splice(t,1)},h=p(()=>a.reduce((t,e)=>t+e.quantity*e.price,0)),k=p(()=>a.length>0&&!a.some(t=>!t.sell));(async()=>{var t,e;try{const{data:s}=await q.get("/users/cart");for(const r of s.result)a.push({_id:r._id,p_id:r.p_id._id,category:r.p_id.category,description:r.description,images:r.p_id.images,name:r.p_id.name,price:r.p_id.price,sell:r.p_id.sell,quantity:r.quantity,key:r._id})}catch(s){y.error({title:"失敗",content:((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"取得購物車失敗",positiveText:"再試一次"})}})();const a=m([]),C=m([{title:"",key:"image",render(t,e){return o("img",{src:a[e].images[0],height:80})}},{title:"商品",key:"name",render(t,e){return o(u,{to:"shop/products/"+a[e].p_id,style:"color: #FFF; text-decoration: none;"},{default:()=>a[e].name})}},{title:"單價",key:"price"},{title:"",key:"-",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,-1)},{default:()=>"-"})}},{title:"數量",key:"quantity"},{title:"",key:"+",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,1)},{default:()=>"+"})}},{title:"小計",key:"productTotalPrice",render(t,e){return o("p",{},{default:()=>t.price*t.quantity})}},{title:"",key:"delete",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,a[e].quantity*-1)},{default:()=>"刪除"})}}]);return(t,e)=>{const s=D,r=P,w=z,b=H;return V(),B("div",S,[F("div",A,[n(s,{class:"pageTitle"},{default:i(()=>[d(" 購物車 ")]),_:1}),n(r),n(w,{columns:C,data:a},null,8,["columns","data"]),n(b,{style:{"align-self":"flex-end"}},{default:i(()=>[d(" 結帳金額：$"+T(c(h)),1)]),_:1}),n(c(u),{to:"/orderbuild",style:{"align-self":"flex-end"}},{default:i(()=>[n(c(l),{disabled:!c(k)},{default:i(()=>[d(" 前往結帳 ")]),_:1},8,["disabled"])]),_:1})])])}}},G=x(E,[["__scopeId","data-v-887ac071"]]);export{G as default};
