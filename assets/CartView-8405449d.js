import{B as N,D as q,S as b,L as x}from"./router-ae37ba64.js";import{Z as u}from"./vue-router-3b4314f2.js";import{aL as D,f as p,n as m,D as V,aD as B,aE as T,H as n,G as i,I as c,j as o,aN as d,aQ as z}from"./plugin-vueexport-helper-f05f1187.js";import{_ as F}from"./DataTable-e597766d.js";import{c as H,N as L}from"./headers-9e312c4a.js";import{e as l}from"./Button-336cb67e.js";import"./Icon-b714c065.js";import"./light-fe558375.js";const S={class:"container"},E={class:"inside"},I={__name:"CartView",setup(P){const y=N(),f=q(),{editCart:g}=f,_=async(t,e)=>{await g({_id:a[t].p_id,quantity:e}),a[t].quantity+=e,a[t].quantity<=0&&a.splice(t,1)},k=p(()=>a.reduce((t,e)=>t+e.quantity*e.price,0)),h=p(()=>a.length>0&&!a.some(t=>!t.sell));(async()=>{var t,e;try{const{data:s}=await b.get("/users/cart");for(const r of s.result)a.push({_id:r._id,p_id:r.p_id._id,category:r.p_id.category,description:r.description,images:r.p_id.images,name:r.p_id.name,price:r.p_id.price,sell:r.p_id.sell,quantity:r.quantity,key:r._id})}catch(s){y.error({title:"失敗",content:((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"取得購物車失敗",positiveText:"再試一次"})}})();const a=m([]),C=m([{title:"",key:"image",render(t,e){return o("img",{src:a[e].images[0],height:80})}},{title:"商品",key:"name",render(t,e){return o(u,{to:"shop/products/"+a[e].p_id,style:"color: #FFF; text-decoration: none;"},{default:()=>a[e].name})}},{title:"單價",key:"price"},{title:"",key:"-",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,-1)},{default:()=>"-"})}},{title:"數量",key:"quantity"},{title:"",key:"+",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,1)},{default:()=>"+"})}},{title:"小計",key:"productTotalPrice",render(t,e){return o("p",{},{default:()=>t.price*t.quantity})}},{title:"",key:"delete",render(t,e){return o(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>_(e,a[e].quantity*-1)},{default:()=>"刪除"})}}]);return(t,e)=>{const s=H,r=x,w=F,v=L;return V(),B("div",S,[T("div",E,[n(s,{class:"pageTitle"},{default:i(()=>[d(" 購物車 ")]),_:1}),n(r),n(w,{columns:C,data:a},null,8,["columns","data"]),n(v,{style:{"align-self":"flex-end"}},{default:i(()=>[d(" 結帳金額：$"+z(c(k)),1)]),_:1}),n(c(u),{to:"/orderbuild",style:{"align-self":"flex-end"}},{default:i(()=>[n(c(l),{disabled:!c(h),type:"primary"},{default:i(()=>[d(" 前往結帳 ")]),_:1},8,["disabled"])]),_:1})])])}}},J=D(I,[["__scopeId","data-v-f3947c04"]]);export{J as default};
