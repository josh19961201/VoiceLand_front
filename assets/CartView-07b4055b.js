import{B as N,D as q,S as b,T as x,L as V}from"./router-079c6ebf.js";import{_ as u}from"./vue-router-23be1caa.js";import{aL as B,l as p,G as m,o as D,K as S,aD as T,aE as z,N as o,M as i,O as c,h as s,aM as _,aQ as F}from"./plugin-vueexport-helper-7abb35e5.js";import{_ as L}from"./DataTable-ad652812.js";import{N as M,a as E}from"./headers-04aa7c74.js";import{e as l}from"./Button-4159ae6a.js";import"./Icon-085b31e9.js";import"./light-1cb1544e.js";const H={class:"container"},P={class:"inside"},A={__name:"CartView",setup(G){const y=N(),f=q(),{editCart:g}=f,d=async(t,e)=>{await g({_id:a[t].p_id,quantity:e}),a[t].quantity+=e,a[t].quantity<=0&&a.splice(t,1)},h=p(()=>a.reduce((t,e)=>t+e.quantity*e.price,0)),k=p(()=>a.length>0&&!a.some(t=>!t.sell));(async()=>{var t,e;try{const{data:n}=await b.get("/users/cart");for(const r of n.result)a.push({_id:r._id,p_id:r.p_id._id,category:r.p_id.category,description:r.description,images:r.p_id.images,name:r.p_id.name,price:r.p_id.price,sell:r.p_id.sell,quantity:r.quantity,key:r._id})}catch(n){y.error({title:"失敗",content:((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"取得購物車失敗",positiveText:"再試一次"})}})();const a=m([]),C=m([{title:"",key:"image",render(t,e){return s("img",{src:a[e].images[0],height:80})}},{title:"商品",key:"name",render(t,e){return s(u,{to:"shop/products/"+a[e].p_id,style:"color: #FFF; text-decoration: none;"},{default:()=>a[e].name})}},{title:"單價",key:"price"},{title:"",key:"-",render(t,e){return s(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>d(e,-1)},{default:()=>"-"})}},{title:"數量",key:"quantity"},{title:"",key:"+",render(t,e){return s(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>d(e,1)},{default:()=>"+"})}},{title:"小計",key:"productTotalPrice",render(t,e){return s("p",{},{default:()=>t.price*t.quantity})}},{title:"",key:"delete",render(t,e){return s(l,{strong:!0,tertiary:!0,size:"small",onClick:()=>d(e,a[e].quantity*-1)},{default:()=>"刪除"})}}]);return D(()=>{x.from(".container",{opacity:0,duration:1})}),(t,e)=>{const n=M,r=V,w=L,v=E;return S(),T("div",H,[z("div",P,[o(n,{class:"pageTitle"},{default:i(()=>[_(" 購物車 ")]),_:1}),o(r),o(w,{columns:C,data:a},null,8,["columns","data"]),o(v,{style:{"align-self":"flex-end"}},{default:i(()=>[_(" 結帳金額：$"+F(c(h)),1)]),_:1}),o(c(u),{to:"/orderbuild",style:{"align-self":"flex-end"}},{default:i(()=>[o(c(l),{disabled:!c(k),type:"primary"},{default:i(()=>[_(" 前往結帳 ")]),_:1},8,["disabled"])]),_:1})])])}}},j=B(A,[["__scopeId","data-v-775fddd8"]]);export{j as default};
