import{C as E,B as P,a7 as x,S as y,P as A,W as G,F as Q,K as W,_ as $,L as J,I as X}from"./router-2a9f4963.js";import{aL as Z,j as b,G as U,K as ee,aD as te,N as a,M as o,O as F,F as ae,aN as f,aE as ne,aQ as le,h as C}from"./plugin-vueexport-helper-7bd45fc8.js";import{_ as se,a as oe}from"./DynamicInput-320a1a18.js";import{c as ie}from"./headers-3957187b.js";import{_ as pe}from"./_common-3a5d9f64.js";import{_ as re}from"./DataTable-09dc83c0.js";import{e as D}from"./Button-0a6df741.js";import{_ as ue}from"./FormItemGridItem-f911bc4d.js";import{_ as de}from"./Switch-23c1b2f9.js";import{_ as _e}from"./Upload-073e6a32.js";import"./vue-router-09c1997e.js";import"./Icon-f0586d91.js";import"./_common-8285f8f7.js";import"./Remove-15a18098.js";import"./Warning-3677e105.js";import"./light-ba0aba9c.js";import"./light-64d1f202.js";import"./Image-51ae2651.js";const me={__name:"ShowsView",setup(ce){const Y=E(),_=P(),w=b(!1),m=b([]),M={image:{required:!0,message:"請上傳圖片"},title:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},date:{},description:{required:!0,message:"這一欄忘了填",trigger:["input","blur"]},artists:{required:!0,message:"請選擇演出者"}},N=[{label:"Sabrina Band",value:"Sabrina Band"},{label:"Coastal Kanpai",value:"Coastal Kanpai"},{label:"Yellow Flower",value:"Yellow Flower"},{label:"Faye Hong",value:"Faye Hong"}],j=[{label:"Facebook",value:"fb"},{label:"Information",value:"info"},{label:"Ticket",value:"ticket"}],B=()=>({linkType:"",link:""}),h=b(null),p=U([]),e=U({_id:"",image:[],title:"",date:x().format("YYYY.MM.DD"),description:"",display:!1,artists:[],links:[],dialog:!1,idx:-1}),T=n=>{n===-1?(e._id="",e.image=[],e.title="",e.date=x().format("YYYY.MM.DD"),e.description="",e.display=!1,e.artists=[],e.links=[],e.dialog=!1,e.idx=-1):(e._id=p[n]._id,e.title=p[n].title,e.date=p[n].date,e.description=p[n].description,e.display=p[n].display,e.artists=p[n].artists,e.links=p[n].links,e.dialog=p[n].dialog,e.idx=n,m.value.push({id:"001",name:"image",status:"finished",url:p[n].image}),e.image=m.value),e.dialog=!0},S=n=>{var t,i;e.image=(i=(t=n.fileList)==null?void 0:t[0])==null?void 0:i.file},g=()=>{m.value=[],e.dialog=!1},V=async()=>{var n;return(n=h.value)==null||n.validate(async t=>{var i,d,u;if(t)Y.error("請檢查資料是否完整");else{const r=new FormData;(i=e.image[0])!=null&&i.url&&(e.image=e.image[0].url),r.append("image",e.image),r.append("title",e.title),r.append("date",e.date),r.append("description",e.description),r.append("display",e.display);for(const s of e.artists)r.append("artists",s);e.links=e.links.map(s=>{const v=s.linkType,c=s.link;return{linkType:v,link:c}});for(const s of e.links)r.append("linksType",Object.entries(s)[0][1]),r.append("linksValue",Object.entries(s)[1][1]);try{if(e._id.length===0){const{data:s}=await y.post("/shows",r);p.push(s.result),_.success({title:"新增成功",content:"演出活動新增成功",positiveText:"確認"}),g()}else{const{data:s}=await y.patch("/shows/"+e._id,r);p[e.idx]=s.result,_.success({title:"編輯成功",content:"演出資訊編輯成功",positiveText:"確認"}),g()}e.dialog=!1}catch(s){_.error({title:"新增失敗",content:((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||"發生錯誤",positiveText:"確認"}),console.log(s)}w.value=!1}}),!1};(async()=>{var n,t;try{const{data:i}=await y.get("/shows/all");p.push(...i.result)}catch(i){_.error({title:"載入失敗",content:((t=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"})}})();const q=(({edit:n})=>[{title:"演出名稱",key:"title"},{title:"日期",key:"date"},{title:"演出者",key:"artists",render(t,i){return C(X,{},{default:()=>t.artists.join("、")})}},{title:"",key:"edit",render(t,i){return C(D,{strong:!0,tertiary:!0,size:"small",onClick:()=>n(t,i)},{default:()=>"編輯"})}}])({edit(n,t){T(t)}});return(n,t)=>{const i=ie,d=A,u=ue,r=de,s=se,v=_e,c=G,I=oe,K=Q,L=W,R=$,H=pe,O=J,z=re;return ee(),te(ae,null,[a(i,{class:"pageTitle"},{default:o(()=>[f(" 演出管理 ")]),_:1}),a(F(D),{onClick:t[0]||(t[0]=l=>T(-1))},{default:o(()=>[f(" 新增演出 ")]),_:1}),a(H,{show:e.dialog,"onUpdate:show":t[8]||(t[8]=l=>e.dialog=l),preset:"dialog",title:"Dialog","negative-text":"取消","positive-text":"送出","mask-closable":!1,"on-negative-click":g,"on-positive-click":V,closable:!1,loading:w.value},{header:o(()=>[ne("div",null,le(e._id.length>0?"編輯演出":"新增演出"),1)]),default:o(()=>[a(R,null,{default:o(()=>[a(L,{ref_key:"fromRef",ref:h,rules:M,model:e},{default:o(()=>[a(K,{cols:12,"x-gap":12},{default:o(()=>[a(u,{span:10,label:"演出名稱",path:"title"},{default:o(()=>[a(d,{value:e.title,"onUpdate:value":t[1]||(t[1]=l=>e.title=l),placeholder:"請輸入活動名稱"},null,8,["value"])]),_:1}),a(u,{span:2,label:"公開",path:"display"},{default:o(()=>[a(r,{value:e.display,"onUpdate:value":t[2]||(t[2]=l=>e.display=l)},null,8,["value"])]),_:1}),a(u,{span:6,label:"演出日期",path:"date"},{default:o(()=>[a(s,{"formatted-value":e.date,"onUpdate:formatted-value":t[3]||(t[3]=l=>e.date=l),"value-format":"yyyy.MM.dd",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),a(u,{span:6,label:"圖片",path:"image"},{default:o(()=>[a(v,{value:e.image,"onUpdate:value":t[4]||(t[4]=l=>e.image=l),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":m.value,max:1,onChange:S},{default:o(()=>[f(" 上傳圖片 ")]),_:1},8,["value","default-file-list"])]),_:1}),a(u,{span:12,label:"演出者",path:"artists"},{default:o(()=>[a(c,{value:e.artists,"onUpdate:value":t[5]||(t[5]=l=>e.artists=l),options:N,multiple:"","show-checkmark":!1},null,8,["value"])]),_:1}),a(u,{span:12,label:"演出資訊",path:"description"},{default:o(()=>[a(d,{value:e.description,"onUpdate:value":t[6]||(t[6]=l=>e.description=l),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"說說這場演出有多酷！"},null,8,["value"])]),_:1}),a(u,{span:12,label:"外部連結",path:"links"},{default:o(()=>[a(I,{value:e.links,"onUpdate:value":t[7]||(t[7]=l=>e.links=l),"on-create":B},{"create-button-default":o(()=>[f(" 加入外部連結 ")]),default:o(({value:l})=>[a(c,{value:l.linkType,"onUpdate:value":k=>l.linkType=k,options:j},null,8,["value","onUpdate:value"]),a(d,{value:l.link,"onUpdate:value":k=>l.link=k,type:"text",placeholder:"請輸入連結"},null,8,["value","onUpdate:value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","loading"]),a(O),a(z,{columns:F(q),data:p},null,8,["columns","data"])],64)}}},Se=Z(me,[["__scopeId","data-v-e9b0bcf3"]]);export{Se as default};
