import{F as N,G as T,P as f,L as C,_ as F,K as R}from"./router-48bdd7c6.js";import{_ as S}from"./Upload-c49b4ef2.js";import{J as d,a8 as V,ad as L,aX as U,ag as l,af as i,a7 as q,b5 as c,aY as A}from"./plugin-vueexport-helper-0effeee0.js";import{c as D}from"./headers-888afa08.js";import{N as H,_ as j}from"./Divider-ab21959c.js";import"./PersonOutline-bba22013.js";import"./Icon-e4f27f28.js";import"./light-76ed7333.js";import"./Image-57c9f990.js";import"./light-cc3ac0f3.js";const z=A("br",null,null,-1),W={__name:"HomeView",setup(E){const m=N(),b=T(),u=d(!1),h={intro:{required:!0,message:"請輸入介紹文字"}},g=d(null),a=V({intro:"",banners:[]}),y=async()=>{var s,n;try{const{data:e}=await f.get("/intro");a.intro=e.result[0].intro,p.value.push(...e.result[0].banners.map((t,r)=>({id:r.toString(),name:r.toString(),status:"finished",url:t}))),a.banners=p.value}catch(e){console.log(e),m.error({title:"載入失敗",content:((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"發生錯誤",positiveText:"確認"})}},p=d([]),w=s=>{let n=[],e=[];n=s.fileList.map(t=>t.url).filter(t=>t!==null),e=s.fileList.map(t=>t.file).filter(t=>t!==null),a.banners=[...n,...e]},x=async()=>{var s;(s=g.value)==null||s.validate(async n=>{var e,t;if(n)b.error("請檢查資料是否完整"),u.value=!1;else{const r=new FormData;r.append("intro",a.intro),a.banners=a.banners.map(o=>o.url?o.url:o);for(const o of a.banners)r.append("banners",o);try{u.value=!0,await f.patch("/intro",r),m.success({title:"編輯成功",content:"首頁資訊編輯成功",positiveText:"確認"}),u.value=!1}catch(o){m.error({title:"新增失敗",content:((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"發生錯誤",positiveText:"確認"}),console.log(o),u.value=!1}u.value=!1}})};return(async()=>{var s,n;try{const{data:e}=await f.get("/intro");a.intro=e.result[0].intro,p.value.push(...e.result[0].banners.map((t,r)=>({id:r.toString(),name:r.toString(),status:"finished",url:t}))),a.banners=p.value}catch(e){console.log(e),m.error({title:"載入失敗",content:((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"發生錯誤",positiveText:"確認"})}})(),(s,n)=>{const e=D,t=j,r=F,o=R,k=S,B=C,v=H;return L(),U(q,null,[l(e,{class:"pageTitle"},{default:i(()=>[c(" 首頁管理 ")]),_:1}),l(t),l(B,{ref_key:"fromRef",ref:g,rules:h,model:a,"show-require-mark":!1},{default:i(()=>[l(o,{label:"About Us",path:"intro"},{default:i(()=>[l(r,{value:a.intro,"onUpdate:value":n[0]||(n[0]=_=>a.intro=_),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"請輸入介紹文字"},null,8,["value"])]),_:1}),l(o,{label:"Banner",path:"banners"},{default:i(()=>[l(k,{value:a.banners,"onUpdate:value":n[1]||(n[1]=_=>a.banners=_),"list-type":"image-card",accept:".jpg,.jpeg,.png,.gif,.bmp,.tiff,.svg,.webp","default-file-list":p.value,multiple:!0,max:5,onChange:w},{default:i(()=>[c(" 建議大小 "),z,c(" 1920 * 1080 ")]),_:1},8,["value","default-file-list"])]),_:1})]),_:1},8,["model"]),l(v,{onClick:y},{default:i(()=>[c(" 取消 ")]),_:1}),l(v,{loading:u.value,type:"primary",onClick:x},{default:i(()=>[c(" 修改 ")]),_:1},8,["loading"])],64)}}};export{W as default};
